$(document).ready(function(){function a(a){var b=a>=0?"constructive":"destructive";return $("<span>").text((0>a?"":"+")+a.toFixed(2)).addClass("mw-ui-text").addClass("mw-ui-"+b)}function b(){var a=[];$(".score_component").each(function(){a.push($(this).attr("delta"))});var b=d3.select("svg").attr("width",l).attr("height",m);b.selectAll("rect").data(a)}function c(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")}const d=864e5,e=1.25,f=1.4,g=1.25,h=1.4,i="http://en.wikipedia.org/w/api.php",j="&format=json&callback=?&continue=";var k={"Edit count":{url:function(a){return[i+"?action=query&list=users&usprop=editcount&ususers=User:"+a+j]},metric:function(a){var b=a.query.users[0].editcount;return{raw:b,formatted:c(b)}},delta:function(a){return 350>a?-250:e*(71.513*Math.log(a)-621.0874)}},Blocks:{url:function(a){return[i+"?action=query&list=users&ususers="+a+"&usprop=blockinfo"+j,i+"?action=query&list=logevents&letitle=User:"+a+"&leaction=block/block"+j]},metric:function(a,b){a=a[0],b=b[0];a.query.users[0].hasOwnProperty("blockexpiry");if(a.query.users[0].hasOwnProperty("blockexpiry")){var e=a.query.users[0].blockexpiry;return{raw:e,formatted:"infinity"===e?"<b>indefinitely blocked</b>":"currently blocked for "+e}}var f=b.query.logevents.length;if(0===f)return{raw:{count:0,since:0/0},formatted:"never blocked"};var g=(Date.now()-Date.parse(b.query.logevents[0].timestamp))/d;return{raw:{count:f,since:g},formatted:f+" block"+(1==f?"":"s")+" (last one was "+c(g.toFixed(1))+" days ago)"}},delta:function(a){if("infinity"===a)return-500;if(a.hasOwnProperty("count")){if(0===a.count)return 140;var b=.1977*a.since-92.3255;return b-=10*a.count,b>100&&(b=100),f*b}return-100}},"Account age":{url:function(a){return[i+"?action=query&list=users&ususers="+a+"&usprop=registration"+j]},metric:function(a){var b=(Date.now()-Date.parse(a.query.users[0].registration))/d;return{raw:b,formatted:c(b.toFixed(1))+" days"}},delta:function(a){return 43>a?-250:g*(91.482*Math.log(a)-544.85)}},"User page":{url:function(a){return[i+"?action=query&prop=revisions&rvprop=content&titles=User:"+a+j]},metric:function(a){if(a.query.pages.hasOwnProperty("-1"))return{raw:"missing",formatted:"missing"};var b=Object.keys(a.query.pages)[0],c=a.query.pages[b].revisions[0]["*"],d=0===c.lastIndexOf("#REDIRECT",0),e=d?"redirect":"exists";return{raw:e,formatted:e}},delta:function(a){switch(a){case"missing":return-50;case"redirect":return-10;case"exists":return 10}}},"User rights":{url:function(a){return[i+"?action=query&list=users&usprop=groups&ususers="+a+j]},metric:function(a){var b=["*","user","autoconfirmed"],c=function(a){return b.indexOf(a)<0},d=$.grep(a.query.users[0].groups,c);if(0===d.length)return{raw:d,formatted:"none"};if(1===d.length)return{raw:d,formatted:d[0]};if(2===d.length)return{raw:d,formatted:d[0]+" and "+d[1]};for(var e=d[0],f=1;f<d.length-1;f++)e+=", "+d[f];return e+=", and "+d[d.length-1],{raw:d,formatted:e}},delta:function(a){var b=0;const c={abusefilter:25,accountcreator:10,autoreviewer:20,checkuser:25,filemover:15,reviewer:5,rollbacker:5,templateeditor:20};for(var d=0;d<a.length;d++)c.hasOwnProperty(a[d])&&(b+=c[a[d]]);return b>100&&(b=100),b}},"Pages created":{url:function(a){return[i+"?action=query&list=usercontribs&ucuser="+a+"&uclimit=500&ucdir=older&ucprop=title&ucshow=new&ucnamespace=0"+j]},metric:function(a){var b=a.query.usercontribs.length;return{raw:b,formatted:b+" article-space pages created"}},delta:function(a){return h*(36.07161*Math.log(a)-68.8246)}}};$("#submit").click(function(){var c=$("#username").val();return $("#error").hide(),$("#result").hide(),""===c?($("#error").empty(),$("#error").show(),void $("#error").append($("<div>").addClass("errorbox").text("No username specified."))):($("#result").show(),$("#score_wrapper").text("Admin score for "+c+": ").append($("<span>").text("0").attr("id","score")),$("#components").empty(),void $.each(k,function(d,e){var f=function(c){var f=e.delta(c.raw);if("Block status"!==d||0!==f){$("#components").append($("<li>").attr("delta",f).addClass("score_component").append(d+": ").append(c.formatted).append(" (").append(a(f)).append(")"));var g=parseFloat($("#score").text());g+=f,$("#score").text(g.toFixed(1))}b()},g=e.url(c);1==g.length?$.getJSON(g[0],function(a){f(e.metric(a))}):2==g.length&&$.when($.getJSON(g[0]),$.getJSON(g[1])).then(function(a,b){f(e.metric(a,b))})}))});const l=500,m=200});