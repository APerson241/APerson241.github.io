$(document).ready(function(){function a(){var a=[],b=0;$(".score_component").each(function(){var c=parseFloat($(this).attr("delta")),d=$(this).attr("name");0!==c&&(b+=c,a.push([b,d]))});var c=20,d=(a.length-1)*n,e=a.length*c,f=d+e;height=Math.min(m,f);var g=d3.scale.linear().domain(d3.extent(a,function(a){return a[0]})).rangeRound([o,460]),h=d3.svg.axis().scale(g).orient("bottom").ticks(7);a=$.map(a,function(a){return[[g(a[0]),a[1]]]});var i=d3.select("svg").attr("width",550).attr("height",height+o);i.selectAll("*").remove();var j=function(b,c,d){if(d=d||0,0===c)return d;var e=Math.min(b[0],a[c-1][0])+d;return e},k=function(b,c){return 0===c?b[0]:Math.abs(b[0]-a[c-1][0])};i.selectAll("rect").data(a).enter().append("rect").attr("x",j).attr("y",function(a,b){return b*c}).attr("width",k).attr("height",function(){return c-n}).attr("class",function(b,c){if(0===c)return"positive-delta";var d=b[0]-a[c-1][0]>=0;return(d?"positive":"negative")+"-delta"}),i.selectAll("text").data(a).enter().append("text").text(function(a){return a[1]}).attr("class","bar-label").attr("x",function(a,b){var c=j(a,b,p),d=k(a,b);return this.getComputedTextLength()>=d-10&&(c+=d,c-=2.5),c}).attr("y",function(a,b){return b*c+14}).attr("fill",function(a,b){var c=this.getComputedTextLength()>=k(a,b)-10;return c?"black":"white"}),i.append("g").attr("class","graph-axis").attr("transform","translate(0, "+height+")").call(h)}function b(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")}function c(a){var b=a>=0?"constructive":"destructive";return $("<span>").text((0>a?"":"+")+a.toFixed(2)).addClass("mw-ui-text").addClass("mw-ui-"+b)}const d=864e5,e=1.25,f=1.4,g=1.25,h=1.4,i=.9,j="http://en.wikipedia.org/w/api.php",k="&format=json&callback=?&continue=";var l={"Edit count":{url:function(a){return[j+"?action=query&list=users&usprop=editcount&ususers=User:"+a+k]},metric:function(a){var c=a.query.users[0].editcount;return{raw:c,formatted:b(c)}},delta:function(a){return 350>a?-250:e*(71.513*Math.log(a)-621.0874)}},Blocks:{url:function(a){return[j+"?action=query&list=users&ususers="+a+"&usprop=blockinfo"+k,j+"?action=query&list=logevents&letitle=User:"+a+"&leaction=block/block"+k]},metric:function(a,c){a=a[0],c=c[0];a.query.users[0].hasOwnProperty("blockexpiry");if(a.query.users[0].hasOwnProperty("blockexpiry")){var e=a.query.users[0].blockexpiry;return{raw:e,formatted:"infinity"===e?"<b>indefinitely blocked</b>":"currently blocked for "+e}}var f=c.query.logevents.length;if(0===f)return{raw:{count:0,since:0/0},formatted:"never blocked"};var g=(Date.now()-Date.parse(c.query.logevents[0].timestamp))/d;return{raw:{count:f,since:g},formatted:f+" block"+(1==f?"":"s")+" (last one was "+b(g.toFixed(1))+" days ago)"}},delta:function(a){if("infinity"===a)return-500;if(a.hasOwnProperty("count")){if(0===a.count)return 140;var b=.1977*a.since-92.3255;return b-=10*a.count,b>100&&(b=100),f*b}return-100}},"Account age":{url:function(a){return[j+"?action=query&list=users&ususers="+a+"&usprop=registration"+k]},metric:function(a){var c=(Date.now()-Date.parse(a.query.users[0].registration))/d,e=b(c.toFixed(1)),f=(c/365).toFixed(2);return{raw:c,formatted:e+" days ("+f+" years)"}},delta:function(a){return 43>a?-250:g*(91.482*Math.log(a)-544.85)}},"User page":{url:function(a){return[j+"?action=query&prop=revisions&rvprop=content&titles=User:"+a+k]},metric:function(a){if(a.query.pages.hasOwnProperty("-1"))return{raw:"missing",formatted:"missing"};var b=Object.keys(a.query.pages)[0],c=a.query.pages[b].revisions[0]["*"],d=0===c.lastIndexOf("#REDIRECT",0),e=d?"redirect":"exists";return{raw:e,formatted:e}},delta:function(a){switch(a){case"missing":return-50;case"redirect":return-10;case"exists":return 10}}},"User rights":{url:function(a){return[j+"?action=query&list=users&usprop=groups&ususers="+a+k]},metric:function(a){var b=["*","user","autoconfirmed"],c=function(a){return b.indexOf(a)<0},d=$.grep(a.query.users[0].groups,c);if(0===d.length)return{raw:d,formatted:"none"};if(1===d.length)return{raw:d,formatted:d[0]};if(2===d.length)return{raw:d,formatted:d[0]+" and "+d[1]};for(var e=d[0],f=1;f<d.length-1;f++)e+=", "+d[f];return e+=", and "+d[d.length-1],{raw:d,formatted:e}},delta:function(a){var b=0;const c={abusefilter:25,accountcreator:10,autoreviewer:20,checkuser:25,filemover:15,reviewer:5,rollbacker:5,templateeditor:20};for(var d=0;d<a.length;d++)if(c.hasOwnProperty(a[d])&&(b+=c[a[d]]),"sysop"===a[d]||"bureaucrat"===a[d])return 500;return b>100&&(b=100),b}},"Pages created":{usesListLength:!0,url:function(a){return[j+"?action=query&list=usercontribs&ucuser="+a+"&uclimit=500&ucdir=older&ucprop=title&ucshow=new&ucnamespace=0"+k]},getList:function(a){return a.query.usercontribs},metric:function(a){return{raw:a,formatted:a+" article-space pages created"}},delta:function(a){var b=36.07161*Math.log(a)-68.8246;return-100>b&&(b=-100),h*b}},Activity:{usesListLength:!0,url:function(a){var b=new Date;return b.setFullYear(b.getFullYear()-1),b=b.toISOString(),[j+"?action=query&list=usercontribs&ucuser="+a+"&uclimit=500&ucprop=timestamp&ucend="+b+k]},getList:function(a){return a.query.usercontribs},metric:function(a){var c=a/12,d=b(c.toFixed(1));return{raw:c,formatted:d+" edits per month, on average (over the last year)"}},delta:function(a){var b=30.41375*Math.log(a)-138.48563;return-50>b&&(b=-50),i*b}}};$("#submit").click(function(){var d=$("#username").val();return $("#error").hide(),$("#result").hide(),""===d?($("#error").empty(),$("#error").show(),void $("#error").append($("<div>").addClass("errorbox").text("No username specified."))):($("#result").show(),$("#score_wrapper").text("Admin score for "+d+": ").append($("<span>").text("0").attr("id","score")),$("#components").empty(),d3.selectAll("svg").selectAll("*").remove(),void $.each(l,function(e,f){var g=function(d){var g=f.delta(d.raw);if("Block status"!==e||0!==g){$("#components").append($("<li>").attr("delta",g).attr("name",e).addClass("score_component").append(e+": ").append(d.formatted).append(" (").append(c(g)).append(")"));var h=parseFloat($("#score").text().replace(/,/,"")),i=h+g;i=i.toFixed(1),$("#score").text(b(i))}a()},h=f.url(d);if(1==h.length)if(f.hasOwnProperty("usesListLength")){var i=0,j=h[0].replace(/continue=/,"");query=function(a){var b=j+a;$.getJSON(b,function(a){var b=f.getList(a);if(i+=b.length,a.hasOwnProperty("continue")){var c="uccontinue="+a["continue"].uccontinue+"&continue="+a["continue"]["continue"];query(c)}else g(f.metric(i))})},query("continue=")}else $.getJSON(h[0],function(a){g(f.metric(a))});else 2==h.length&&$.when($.getJSON(h[0]),$.getJSON(h[1])).then(function(a,b){g(f.metric(a,b))})}))});const m=200,n=2,o=20,p=5});